<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <template id="report_invoice_footer">
        <div class="row">
            <div class="col-xs-4 pull-right">
                <table class="table table-condensed">
                    <tr class="border-black">
                        <td><strong>Imponibile</strong></td>
                        <td class="text-right">
                            <span t-field="o.amount_untaxed" t-options='{"widget": "monetary", "display_currency": o.currency_id}'/>
                        </td>
                    </tr>
                    <t t-foreach="o._get_tax_amount_by_group()" t-as="amount_by_group">
                        <tr>
                            <td><span t-esc="amount_by_group[0] if len(o.tax_line_ids) > 1 else (o.tax_line_ids.tax_id.description or o.tax_line_ids.tax_id.name)"/></td>
                            <td class="text-right">
                                <span t-esc="amount_by_group[2]"/>
                            </td>
                        </tr>
                    </t>
                    <tr class="border-black">
                        <td><strong>Totale</strong></td>
                        <td class="text-right">
                            <span t-field="o.amount_total" t-options='{"widget": "monetary", "display_currency": o.currency_id}'/>
                        </td>
                    </tr>
                    <tr t-if="o.amount_net_pay != o.amount_total" class="border-black">
                        <td><strong>Totale a pagare</strong></td>
                        <td class="text-right">
                            <span t-field="o.amount_net_pay" t-options='{"widget": "monetary", "display_currency": o.currency_id}'/>
                        </td>
                    </tr>
                </table>
            </div>
        </div>

        <!-- DO NOT REMOVE THIS TABLE. MANDATORY IN SOME COUNTRIES -->
        <div class="row" t-if="len(o.tax_line_ids) > 0">
            <div class="col-xs-6">
                <table class="table table-condensed">
                    <thead>
                        <tr>
                            <th>IVA</th>
                            <th class="text-right">Base imponibile</th>
                            <th class="text-right">Importo</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr t-foreach="o.tax_line_ids" t-as="t">
                            <td><span t-field="t.tax_id.description"/></td>
                            <td class="text-right">
                                <span t-field="t.base" t-options='{"widget": "monetary", "display_currency": o.currency_id}'/>
                            </td>
                            <td class="text-right">
                                <span t-field="t.amount" t-options='{"widget": "monetary", "display_currency": o.currency_id}'/>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <t t-call="base_multireport.report_invoice_payment_dues"/>

        <p t-if="o.comment" class="col-xs-12">
            <strong>Note:</strong>
            <span t-field="o.comment"/>
        </p>
        <p t-if="o.payment_term_id and report.get_report_attrib('payment_term_position',o,doc_opts) != 'odoo'" class="col-xs-12">
            <span t-field="o.payment_term_id.note"/>
        </p>
        <p t-if="o.fiscal_position_id.note" class="col-xs-12">
            <strong>Note fiscali:</strong>
            <span t-field="o.fiscal_position_id.note"/>
        </p>
        <p t-if="report.get_report_attrib('bottom_text',o,doc_opts)" class="col-xs-12">
            <span t-esc="report.get_report_attrib('bottom_text',o,doc_opts)"/>
        </p>
        <p t-if="ending_message" class="col-xs-12">
            <span t-esc="ending_message"/>
        </p>
    </template>


    <template id="report_invoice_payment_dues">
        <t t-set="o" t-value="o.with_context({'lang':o.partner_id.lang})" />

        <div t-if="doc_opts.payment_term_position == 'footer' or (doc_opts.payment_term_position == 'auto' and len(o.due_records) > 1)"  class="col-xs-6 pull-left" style="padding-top:1px; padding-left:0px; padding-right:0px; page-break-inside: avoid;">
            <p><strong>Payment Term:</strong></p>
            <p t-if="o.payment_term_id.note" t-field="o.payment_term_id.note"/>
            <p t-if="not o.payment_term_id.note" t-field="o.payment_term_id"/>
            <p t-if="o.type in ['in_refund', 'out_refund']"><strong >Refunds:</strong></p>
            <p t-if="o.type in ['in_invoice', 'out_invoice']"><strong >Payments:</strong></p>
            <p t-if="o.partner_bank_id and doc_opts.payment_term_position == 'footer'">
                <strong>IBAN:</strong>
                <span t-field="o.partner_bank_id.display_name"/>
            </p>
            <p t-if="not o.partner_bank_id and o.partner_id.bank_ids and o.payment_term_id and o.payment_term_id.riba or o.payment_term_id.fatturapa_pm_id.code in ('MP11', 'MP12', 'MP16', 'MP17', 'MP19', 'MP20', 'MP21') and doc_opts.payment_term_position == 'footer'">
                <strong>IBAN:</strong>
                <p>
                    <t t-foreach="o.partner_id.bank_ids" t-as="bank"><span t-field="bank.display_name"/></t>
                </p>
            </p>
            <p t-if="not o.partner_bank_id and o.company_id.partner_id.bank_ids and o.payment_term_id and o.payment_term_id.fatturapa_pm_id.code in ('MP05', 'MP07', 'MP08', 'MP13', 'MP18') and doc_opts.payment_term_position == 'footer'">
                <strong>IBAN:</strong>
                <p>
                    <t t-foreach="o.company_id.partner_id.bank_ids" t-as="bank"><span t-if="len(bank.display_name) &gt; 16" t-field="bank.display_name"/></t>
                </p>
            </p>
            <table class="table table-condensed">
                <thead >
                    <tr>
                        <th>N.</th>
                        <th>Data</th>
                        <th>Importo</th>
                    </tr>
                </thead>
                <tbody>
                    <t t-foreach="o.due_records" t-as="p">
                        <tr>
                            <td><span t-esc="p_index + 1"/></td>
                            <td><span t-field="p.date_maturity"/></td>
                            <td t-if="o.type in ['in_refund', 'out_invoice']" class="text-right"><span t-field="p.debit"/></td>
                            <td t-if="o.type in ['in_invoice', 'out_refund']" class="text-right"><span t-field="p.credit"/></td>
                        </tr>
                    </t>
                </tbody>
            </table>
        </div>

    </template>

</odoo>

